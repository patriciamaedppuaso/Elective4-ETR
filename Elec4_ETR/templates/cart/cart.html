{% extends 'base.html' %}

{% block title %}Cart - Digicam Shop{% endblock %}

{% block css %}
<style>
    .cart-header {
        background: linear-gradient(135deg, var(--teal), var(--burnt-orange));
        color: white;
        padding: 40px 0;
        margin: -30px -15px 30px -15px;
        border-radius: 0 0 20px 20px;
    }
    .cart-header h3 {
        color: white;
        font-size: 2.5rem;
        margin: 0;
    }
    .cart-container {
        background-color: white;
        padding: 30px;
        border-radius: 15px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }
    .total-section {
        background: linear-gradient(135deg, var(--mustard-yellow), var(--burnt-orange));
        padding: 25px;
        border-radius: 15px;
        margin-top: 30px;
        color: var(--dark-gray);
    }
    .total-section h4 {
        color: var(--dark-gray);
        font-weight: bold;
        font-size: 2rem;
    }
    .payment-section {
        background-color: #f8f9fa;
        padding: 20px;
        border-radius: 15px;
        margin-top: 20px;
    }
</style>
{% endblock %}

{% block content %}
<div class="cart-header text-center">
    <div class="container">
        <h3>ðŸ›’ Your Cart</h3>
        <p class="mt-2">Review your selected cameras</p>
    </div>
</div>

<div class="container">
<div class="cart-container">
<form method="POST" action="{{ url_for('checkout') }}" enctype="multipart/form-data">
    <table class="table table-bordered">
        <thead class="table-dark">
            <tr>
                <th>Select</th>
                <th>Product</th>
                <th>Qty</th>
                <th>Price</th>
                <th>Subtotal</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody>
            {% for item in items %}
            <tr>
                <td class="text-center">
                    {% if item.stock > 0 %}
                        <input type="checkbox"
                            name="selected_items"
                            value="{{ item.id }}"
                            checked
                            class="select-item"
                            data-subtotal="{{ item.subtotal }}">
                    {% else %}
                        <span class="badge bg-danger">Sold Out</span>
                    {% endif %}
                </td>
                <td><strong>{{ item.name }}</strong></td>
                <td>
                    <input type="number" name="quantity_{{ item.id }}"
                        value="{{ item.quantity }}"
                        min="1"
                        class="form-control form-control-sm w-50"
                        {% if item.stock == 0 %} disabled {% endif %}>
                </td>
                <td>â‚±{{ item.price }}</td>
                <td><strong>â‚±{{ item.subtotal }}</strong></td>
                <td>
                    <a href="{{ url_for('remove_from_cart', id=item.id) }}"
                    class="btn btn-sm btn-danger">Remove</a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <div class="total-section text-center">
        <h4>Total: â‚±<span id="total">{{ total }}</span></h4>
    </div>

    <div class="payment-section">
        <h5 class="mb-3" style="color: var(--teal);">Payment Method</h5>
        <select name="payment_method" id="payment_method" class="form-select mb-3" required>
            <option value="">Select Payment Method</option>
            <option value="Cash on Delivery">Cash on Delivery</option>
            <option value="Online Payment">Online Payment</option>
        </select>

        <div id="proof_section" class="mb-3" style="display:none;">
            <label class="form-label"><strong>Upload Proof of Payment</strong></label>
            <input type="file" name="payment_proof" class="form-control" accept="image/*">
        </div>

        <button class="btn btn-success btn-lg w-100">Place Order</button>
    </div>
</form>
</div>
</div>

<script>
document.getElementById('payment_method').addEventListener('change', function () {
    document.getElementById('proof_section').style.display =
        this.value === 'Online Payment' ? 'block' : 'none';
});

function updateTotal() {
    let total = 0;
    document.querySelectorAll('.select-item').forEach(cb => {
        if (cb.checked) {
            total += parseFloat(cb.dataset.subtotal);
        }
    });
    document.getElementById('total').textContent = total.toFixed(2);
}

updateTotal();
document.querySelectorAll('.select-item').forEach(cb => {
    cb.addEventListener('change', updateTotal);
});
</script>

{% endblock %}
