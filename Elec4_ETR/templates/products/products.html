{% extends 'base.html' %}
{% block title %}Products - Digicam Shop{% endblock %}

{% block css %}
<style>
    .products-header {
        background: 
            repeating-linear-gradient(45deg, var(--teal) 0%, #16A085 50%, var(--teal) 100%),
            linear-gradient(135deg, var(--teal), var(--burnt-orange));
        background-size: 30px 30px, 100%;
        color: white;
        padding: 50px 0;
        margin: -30px -15px 30px -15px;
        border-radius: 0;
        border-bottom: 6px double var(--dark-gray);
        position: relative;
    }
    .products-header::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: repeating-linear-gradient(90deg, var(--mustard-yellow) 0%, var(--mustard-yellow) 10px, transparent 10px, transparent 20px);
    }
    .products-header h3 {
        color: white;
        font-size: 3.5rem;
        margin: 0;
        font-family: 'Bebas Neue', 'Oswald', sans-serif;
        text-transform: uppercase;
        letter-spacing: 4px;
        text-shadow: 3px 3px 0px var(--dark-gray);
        position: relative;
    }
    .products-header h3::before,
    .products-header h3::after {
        content: '‚ùã';
        color: var(--mustard-yellow);
        font-size: 2rem;
        margin: 0 20px;
    }
    .filter-section {
        background: 
            repeating-linear-gradient(45deg, transparent, transparent 10px, rgba(0,0,0,0.02) 10px, rgba(0,0,0,0.02) 20px),
            linear-gradient(135deg, rgba(255,255,255,0.98) 0%, rgba(249,231,159,0.3) 100%);
        padding: 30px;
        border-radius: 0;
        margin-bottom: 30px;
        border: 4px double var(--dark-gray);
        box-shadow: 6px 6px 0px rgba(0,0,0,0.15);
        position: relative;
    }
    .sold-out-badge {
        position: absolute;
        top: 10px;
        right: 10px;
        background-color: var(--burnt-orange);
        color: white;
        padding: 12px 18px;
        border-radius: 0;
        border: 3px solid var(--dark-gray);
        font-weight: bold;
        font-size: 0.9rem;
        font-family: 'Oswald', sans-serif;
        text-transform: uppercase;
        letter-spacing: 2px;
        z-index: 10;
        box-shadow: 4px 4px 0px rgba(0,0,0,0.3);
        transform: rotate(-5deg);
    }
    .card-img-top {
        height: 250px;
        object-fit: cover;
        border-radius: 0;
        border-bottom: 4px double var(--dark-gray);
        filter: sepia(10%) contrast(1.1);
        position: relative;
    }
    .card-img-top::after {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: 
            repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(0,0,0,0.02) 2px, rgba(0,0,0,0.02) 4px);
        pointer-events: none;
    }
    .card-body h5 {
        color: var(--dark-gray);
        font-weight: bold;
        margin-bottom: 10px;
    }
    .card-body p {
        color: var(--dark-gray);
        margin: 5px 0;
    }
    .price-tag {
        font-size: 2rem;
        font-weight: 900;
        color: var(--teal);
        margin: 15px 0;
        font-family: 'Oswald', sans-serif;
        text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        position: relative;
        display: inline-block;
        padding: 5px 15px;
        border: 2px solid var(--teal);
        background: rgba(26, 188, 156, 0.1);
    }
    .price-tag::before {
        content: '‚Ç±';
        font-size: 1.2rem;
        margin-right: 3px;
    }
</style>
{% endblock %}

{% block content %}
<div class="products-header text-center">
    <div class="container">
        <h3>üì∑ Vintage Camera Collection</h3>
        <p class="mt-2">Discover our curated selection of retro and classic cameras</p>
    </div>
</div>

<div class="container">
<div class="filter-section mb-4">
    <form method="get">
        <!-- Search Section (Always Visible) -->
        <div class="row g-2 mb-3">
            <div class="col-md-5">
                <input type="text"
                    name="search"
                    class="form-control"
                    placeholder="Search vintage cameras....."
                    value="{{ search }}">
            </div>
            <div class="col-md-3">
                <select name="category" class="form-select">
                    <option value="">Category</option>
                    {% for c in categories %}
                        <option value="{{ c.id }}"
                            {% if category == c.id|string %}selected{% endif %}>
                            {{ c.name }}
                        </option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-2">
                <button class="btn btn-primary w-100" type="submit">Search</button>
            </div>
            <div class="col-md-2">
                <button class="btn btn-primary w-10" type="button"
                        data-bs-toggle="collapse"
                        data-bs-target="#filterOptions"
                        aria-expanded="false"
                        aria-controls="filterOptions">
                    <i class="bi bi-funnel"></i>
                </button>
            </div>
        </div>

        <!-- Filter Options (Hidden by default, show if filters are active) -->
        <div class="collapse {% if condition or brand or stock_status %}show{% endif %}" id="filterOptions">
            <div class="row g-2 mb-3">
                <!-- First Row -->
                <div class="col-md-3">
                    <select name="condition" class="form-select">
                        <option value="">Conditions</option>
                        <option value="Brand New" {% if condition == 'Brand New' %}selected{% endif %}>Brand New</option>
                        <option value="Preloved" {% if condition == 'Preloved' %}selected{% endif %}>Preloved</option>
                    </select>
                </div>

                <!-- Second Row -->
                <div class="col-md-3">
                    <select name="brand" class="form-select">
                        <option value="">Brands</option>
                        {% for b in brands %}
                            <option value="{{ b.brand }}"
                                {% if brand == b.brand %}selected{% endif %}>
                                {{ b.brand }}
                            </option>
                        {% endfor %}
                    </select>
                </div>

                <div class="col-md-3">
                    <select name="stock_status" class="form-select">
                        <option value="">Stock</option>
                        <option value="available"
                            {% if stock_status == 'available' %}selected{% endif %}>
                            Available
                        </option>
                        <option value="soldout"
                            {% if stock_status == 'soldout' %}selected{% endif %}>
                            Sold Out
                        </option>
                    </select>
                </div>
            </div>
        </div>
    </form>
</div>

    <div class="row">
        {% for p in products %}
            <div class="col-md-3 mb-4">
                <div class="card h-100 shadow-sm">

                    <!-- IMAGE PLACEHOLDER -->
                    <div class="position-relative">
                        {% if p.image %}
                            <img src="{{ url_for('static', filename='uploads/products/' ~ p.image) }}"
                                class="card-img-top">
                        {% else %}
                            <img src="{{ url_for('static', filename='no-image.png') }}"
                                class="card-img-top">
                        {% endif %}

                        {% if p.stock == 0 %}
                        <div class="sold-out-badge">
                            SOLD<br>OUT
                        </div>
                        {% endif %}

                    </div>

                    <div class="card-body">
                        <h5>{{ p.name }}</h5>

                        <span class="badge bg-info">{{ p.condition_type }}</span>
                        <span class="badge bg-secondary ms-2">{{ p.category }}</span>

                        <p class="price-tag">‚Ç±{{ p.price }}</p>

                        {% if p.stock > 0 %}
                            <a href="{{ url_for('add_to_cart', id=p.id) }}"
                            class="btn btn-sm btn-primary">
                            Add to Cart
                            </a>
                        {% else %}
                            <span class="text-danger">Out of stock</span>
                        {% endif %}
                    </div>
                </div>
            </div>
        {% endfor %}
    </div>

    <nav>
        <ul class="pagination justify-content-center">

            {% if page > 1 %}
            <li class="page-item">
                <a class="page-link"
                href="{{ url_for('products', page=page-1, search=search, category=category, condition=condition, brand=brand, stock_status=stock_status) }}">
                    Previous
                </a>
            </li>
            {% endif %}

            {% for p in range(1, total_pages + 1) %}
            <li class="page-item {% if p == page %}active{% endif %}">
                <a class="page-link"
                href="{{ url_for('products', page=p, search=search, category=category, condition=condition, brand=brand, stock_status=stock_status) }}">
                    {{ p }}
                </a>
            </li>
            {% endfor %}

            {% if page < total_pages %}
            <li class="page-item">
                <a class="page-link"
                href="{{ url_for('products', page=page+1, search=search, category=category, condition=condition, brand=brand, stock_status=stock_status) }}">
                    Next
                </a>
            </li>
            {% endif %}

        </ul>
    </nav>
</div>

{% endblock %}
